<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Interactive Bar Chart of Startup Activity</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <!-- Place favicon.ico in the root directory -->

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans|Roboto+Slab' rel='stylesheet' type='text/css'>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.12.0.min.js"><\/script>')</script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>
        <script src="/d3/d3.min.js"></script>
        <script src="js/footnotes.js" type="text/javascript"></script>
        <style>

        rect.barColor:hover {
          stroke-width:5;
          fill: rgb(194,185,167);
        }

        .axis text {
          font: 10px sans-serif;
          fill: black;
        }

        .axis path,
        .axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }

        .label {
          fill: black;
          font: 10px sans-serif;
        }

        .value {
          fill: black;
          font: 10px sans-serif;
        }

        .tooltip {
			  position: absolute;
			  text-align: left;
			  width: 140px;
			  height: 12px;
			  padding: 8px;
			  margin-top: -20px;
			  font: 10px sans-serif;
			  background: #ddd;
			  pointer-events: none;
				opacity: 0.9;
			  }

        .legend-border {
         stroke-width: 1;
         stroke: rgb(0,0,0);
        }

        .legend-text {
          font: 10px sans-serif;
        }

        .legend-text_0 {
          font-weight: bold;
        }

        .legend-text_5 {
          fill: rgb(255,255,255);
        }

        </style>
        <div class="column">
        <a href="http://www.kevinhxu.com/">Home</a>
        <h1>Top 15 Counties by Number of Companies</h1>
        <p class="directions">Select data using the menu and radio buttons. Hold ctrl to slow down the transitions. Hover mouse over bars and footnotes.</p>
        <p id="chart"></p>
        <p class="captions">Sources: <a href="https://data.crunchbase.com/page/crunchbase-open-data-map-odm" target="_blank">Crunchbase Data</a> as of December 2015, <a href="http://www.census.gov/econ/cbp/" target="_blank">County Business Patterns (2013)</a>, and, of course, <a href="https://en.wikipedia.org/wiki/List_of_law_schools_in_the_United_States" target="_blank">Wikipedia</a>.</p>
        <p id="menu"><b>State Data: </b><select></select></p>
        <form>
          <input class='dataButton' checked='checked' type='radio' name='dataset_button' value='crunchbaseDataButton' id='crunchbase_dataset'> Crunchbase Data<br>
          <input class = 'dataButton' type = 'radio' name='dataset_button' value='cbpDataButton' id='cbp_dataset'> County Business Patterns Data
        </form>
        <h2>Bar chart exploration</h2>
        <p>After <a href="http://www.kevinhxu.com/startup-mapper.html" target="_blank">Startup Mapper</a>, I figured another useful tool to explore the Crunchbase Open Data Map and County Business Patterns datasets would be an interactive bar chart.</p>
        <p>Here, you can see that there's <i>some</i> overlap between the top counties in terms of number of company listings on Crunchbase vs. number of small businesses
          <sup id="fnref:3.smallbizdef">
              <a href="#fn:3.smallbizdef" rel="footnote">1</a>
          </sup> in the County Business Patterns (CBP) dataset, but not a complete one. This isn't too surprising. After all, not every small business is looking for VC funding.</p>
        <p>However, you can definitely see a correlation between the number of law schools in a county vs. the number of small businesses and startups. Whether that's because lawyers (who tend to stick around their alma maters after graduating) spur additional business activity, or because the factors that make certain areas fertile ground for new businesses also attract law school founders is unclear. At the same time, these charts only show <b>volume</b> of companies, rather than overall economic activity. There might be plenty of counties with few startups, but a strong cadre of larger players that boost the local economy. Generally, though, we think of competition as a good thing when it comes to an economy's health&#8212;and especially when it comes to antitrust law.
          <sup id="fnref:3.competition">
            <a href="#fn:3.competition" rel="footnote">2</a>
          </sup></p>
        <p>Personally, I'm a little biased<sup id="fnref:3.alot">
          <a href="#fn:3.alot" rel="footnote">3</a>
        </sup> toward greater competition, particularly when it comes to startups. Working with startups was one of the highlights of my law school experience, and I've been lucky enough to be able to continue that into my professional career. While I certainly don't think life is a <a href="http://www.kevinhxu.com/about-me.html" target="_blank">meritocracy</a>, I do believe that we live in a time of incredible potential for upward mobility. It feels like half of the startups out there are about democratizing something, whether it's <a href="https://medium.com/" target="_blank">publishing</a>, <a href="https://www.khanacademy.org/" target="_blank">education</a>, <a href="http://www.tableau.com/" target="_blank">data analytics</a>, or even <a href="https://zana.io/" target="_blank">entrepreneurship itself</a>.
        <sup id="fnref:3.JOBS">
          <a href="#fn:3.JOBS" rel="footnote">4</a>
        </sup>Of course, these tools really only help if you have the time to learn and apply them&#8212;and time is something that's in short supply for someone working two minimum wage jobs to make ends meet.</p>
        <div class="footnotes">
            <hr>
            <ol>
              <li id="fn:3.smallbizdef">
                <p>Defined as businesses with fewer than 500 employees.
                </p>
              </li>
              <li id="fn:3.competition">
                <p>"The heart of our national economic policy long has been faith in the value of competition." <a href="https://www.ravellaw.com/opinions/41707ed74df6610a14b2dfa08c27701a" target="_blank"><i>Standard Oil Co. v. Trade Comm'N.</i></a>, 340 U.S. 231, 247-48 (1951).
                </p>
              </li>
              <li id="fn:3.alot">
                <p>Okay, maybe a LOT biased.
                </p>
              </li>
              <li id="fn:3.JOBS">
                <p>Even the government's getting in on democratizing startups with the <a href="https://en.wikipedia.org/wiki/Jumpstart_Our_Business_Startups_Act" target="_blank">JOBS Act</a>, but <a href="http://ssrn.com/abstract=2639879/" target="_blank">not everyone's</a> too sure about the ultimate effect of equity crowdfunding.
                </p>
              </li>
            </ol>
        </div>
        <script>

        var margin = {top: 0, right: 175, bottom: 20, left: 170},
        width = 960 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

        var x = d3.scale.linear()
            .range([0, width]);

        var y = d3.scale.ordinal()
            .rangeRoundBands([0, height], .1);

        var svg = d3.select("#chart").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var xAxis = d3.svg.axis()
                          .scale(x)
                          .orient("bottom");

        var legendRectSizeX = 120,
					legendRectSizeY = 15,
					legendSpacing = 4;

        var legendColors = d3.scale.ordinal()
            .domain(["LEGEND", "Number of Law Schools", "0", "1-2", "3-4", "5+"])
            .range(["rgb(255,255,255)", "rgb(255,255,255)", "rgb(239,243,255)", "rgb(189,215,231)", "rgb(107,174,214)", "rgb(33,113,181)"]);

        svg.append("g")
           .attr("class", "x axis")
           .append("text")
           .attr("x", width / 2)
           .attr("y", 25)
           .attr("dy", ".71em")
           .style("text-anchor", "middle")
           .text("Number of Companies");

        svg.append("g")
           .attr("class", "y axis")
         .append("line")
           .attr("class", "domain")
           .attr("y2", height);

        svg.append("g")
           .attr("id", "legend");

        svg.append("rect")
  				 .attr("class", "legend-border")
  				 .attr("width", legendRectSizeX)
  				 .attr("height", legendRectSizeY*6)
  				 .attr("x", width + 45)
  				 .attr("y", (height / 2) - ((legendRectSizeY*6) / 2))
  				 .style("fill", "none");

        var legend = d3.select("#legend");

        legend.selectAll("rect")
           .data(legendColors.range())
           .enter()
           .append("rect")
           .attr("width", legendRectSizeX)
           .attr("height", function(d, i) { return legendRectSizeY; })
           .attr("x", width + 45)
           .attr("y", function(d, i) { return (height / 2) - ((legendRectSizeY*6) / 2) + i*legendRectSizeY; })
           .attr("dy", "1.1em")
           .style("fill", function(d){ return d; });

        legend.append("line")
   				 .attr("class", "legend-separator")
   				 .attr("x1", width + 45)
   				 .attr("y1", (height / 2) - ((legendRectSizeY*6) / 2) + legendRectSizeY)
   				 .attr("x2", width + 45 + legendRectSizeX)
   				 .attr("y2", (height / 2) - ((legendRectSizeY*6) / 2) + legendRectSizeY)
   				 .style("stroke", "rgb(0,0,0)")
   				 .style("stroke-width", "1");

        legend.selectAll("text")
           .data(legendColors.domain())
           .enter()
           .append("text")
           .attr("x", width + 45 + legendRectSizeX/2)
           .attr("y", function(d, i) {return (height / 2) - ((legendRectSizeY*6) / 2) + i*legendRectSizeY} )
           .attr("dy", "1.1em")
           .attr("class", function(d,i) { return "legend-text legend-text_" + i; })
           .style("text-anchor", "middle")
           .text(function(d) { return d; });

        var menu = d3.select("#menu select")
                     .on("change", change);

        var crunchbaseRadioButton = d3.select("#crunchbase_dataset")
                                      .on("click", change);

        var cbpRadioButton = d3.select("#cbp_dataset")
                               .on("click", change);

        var format = d3.format(",d");

        var dataset,
        nest_crunchbase,
        nest_cbp,
        law_schools,
        nest_schools;

        d3.csv("us_law_schools_by_city_state_county.csv", function(error, law_school_data) {
          law_schools = law_school_data;
          nest_schools = d3.nest()
                           .key(function(d) { return d._state; })
                           .key(function(d) { return d._county; })
                           .map(law_school_data);
        })

        d3.csv("countyname_bizcount_population.csv", type, function(error, data) {
          dataset = data;

          nest_crunchbase = d3.nest()
                                 .key(function(d) { return d.state_name; })
                                 .sortValues(function(a,b){
                                   if (b.crunchbase_count > a.crunchbase_count) {
                                     return 1;
                                   } else if (b.crunchbase_count < a.crunchbase_count) {
                                     return -1;
                                   } else {
                                     return 0;
                                   }
                                 })
                                 .map(data);

          nest_cbp = d3.nest()
                            .key(function(d) { return d.state_name })
                            .sortValues(function(a,b){
                              if (b.cbp_small_biz_count > a.cbp_small_biz_count) {
                                return 1;
                              } else if (b.cbp_small_biz_count < a.cbp_small_biz_count) {
                                return -1;
                              } else {
                                return 0;
                              }
                            })
                            .map(data);

          var states = d3.keys(nest_crunchbase).sort();
          states.unshift("All States");

          menu.selectAll("option")
              .data(states)
            .enter()
              .append("option")
              .text(function(d) { return d; } );

          menu.property("value", "All States");

          redraw();
          });

        var ctrlKey;

        d3.select(window)
          .on("keydown", function() { ctrlKey = d3.event.ctrlKey; })
          .on("keyup", function() { ctrlKey = false; });

        function change() {
          d3.transition()
            .duration(ctrlKey ? 5000 : 800)
            .each(redraw);
        }

        function redraw() {
          var county1 = menu.property("value");

          if (crunchbaseRadioButton.node().checked) {
            if (county1 == "All States") {
              var top = dataset.sort(function(a,b) {
                if (b.crunchbase_count > a.crunchbase_count) {
                  return 1;
                } else if (b.crunchbase_count < a.crunchbase_count) {
                  return -1;
                } else {
                  return 0;
                }
              }).slice(0, 15);
            } else {
              var top = nest_crunchbase[county1].slice(0, 15);
            }
          }

          else if (cbpRadioButton.node().checked) {
            if (county1 == "All States") {
              var top = dataset.sort(function(a,b) {
                if (b.cbp_small_biz_count > a.cbp_small_biz_count) {
                  return 1;
                } else if (b.cbp_small_biz_count < a.cbp_small_biz_count) {
                  return -1;
                } else {
                  return 0;
                }
              }).slice(0, 15);
            } else {
              var top = nest_cbp[county1].slice(0, 15);
            }
          }

          y.domain(top.map(function(d) { return d.county_name; }));

          var bar = svg.selectAll(".bar")
                       .data(top, function(d) { return d.county_name; });

          var barEnter = bar.enter().insert("g", ".axis")
                            .attr("class", "bar")
                            .attr("transform", function(d) { return "translate(960," + y(d.county_name) + ")"; })
                            .style("fill-opacity", 0);

          barEnter.append("rect")
                  .attr("width", function(d) {
                    if (crunchbaseRadioButton.node().checked) {
                      return x(d.crunchbase_count);
                    } else {
                      return x(d.cbp_small_biz_count);
                    }})
                  .attr("height", y.rangeBand())
                  .attr("class", "barColor")
                  .on("mouseover", mouseover)
                  .on("mousemove", mousemove)
                  .on("mouseout", mouseout);

          barEnter.append("text")
                  .attr("class", "label")
                  .attr("x", -5)
                  .attr("y", y.rangeBand() / 2)
                  .attr("dy", ".35em")
                  .attr("text-anchor", "end")
                  .text(function(d) { return d.county_name + ", " + d.state_abbv; });

          barEnter.append("text")
                  .attr("class", "value")
                  .attr("x", function(d) {
                    if (crunchbaseRadioButton.node().checked) {
                      return x(d.crunchbase_count) + 3;
                    } else {
                      return x(d.cbp_small_biz_count) + 3;
                    }})
                  .attr("y", y.rangeBand() / 2)
                  .attr("dy", ".35em")
                  .attr("text-anchor", "start")
                  .text(function(d) {
                    if (crunchbaseRadioButton.node().checked) {
                      return format(d.crunchbase_count);
                    } else {
                      return format(d.cbp_small_biz_count);
                    }});

          if (crunchbaseRadioButton.node().checked) {
            x.domain([0, top[0].crunchbase_count]);
          } else {
            x.domain([0, top[0].cbp_small_biz_count]);
          }

          var barUpdate = d3.transition(bar)
                            .attr("transform", function(d) { return "translate(0," + (d.y0 = y(d.county_name)) + ")"; })
                            .style("fill-opacity", 1);

          barUpdate.select("rect")
                   .attr("width", function(d) {
                     if (crunchbaseRadioButton.node().checked) {
                       return x(d.crunchbase_count);
                     } else {
                       return x(d.cbp_small_biz_count);
                     }})
                  .style("fill", barColor);

          barUpdate.select(".value")
                   .attr("x", function(d) {
                     if (crunchbaseRadioButton.node().checked) {
                       return x(d.crunchbase_count) + 3;
                     } else {
                       return x(d.cbp_small_biz_count) + 3;
                     }})
                   .text(function(d) {
                     if (crunchbaseRadioButton.node().checked) {
                       return format(d.crunchbase_count);
                     } else {
                       return format(d.cbp_small_biz_count);
                     }});

          var barExit = d3.transition(bar.exit())
                          .attr("transform", function(d) { return "translate(960," + d.y0 + ")"; })
                          .style("fill-opacity", 0)
                          .remove();

          barExit.select("rect")
              .attr("width", function(d) {
                if (crunchbaseRadioButton.node().checked) {
                  return x(d.crunchbase_count);
                } else {
                  return x(d.cbp_small_biz_count);
                }})

          barExit.select(".value")
              .text(function(d) {
                if (crunchbaseRadioButton.node().checked) {
                  return format(d.crunchbase_count);
                } else {
                  return format(d.cbp_small_biz_count);
                }});

          d3.transition(svg).select(".x.axis")
              .attr("transform", function() { return "translate(0," + height + ")"; } )
              .call(xAxis);
        }

        function type(d) {
          d.crunchbase_count = +d.crunchbase_count; //coerce to number
          d.cbp_small_biz_count = +d.cbp_small_biz_count;
          d.pop_est_2013 = +d.pop_est_2013;
          return d;
        }

        var div = d3.select("body").append("div")
							    .attr("class", "tooltip")
							    .style("display", "none");

        function mouseover() {
			  div.style("display", "inline");
        d3.select(this)
          .style("stroke", "rgb(253,181,21)")
          .style("stroke-width", 2)
			}

        function mousemove(d) {
          if(nest_schools[d.state_name] == undefined || nest_schools[d.state_name][d.county_name] == undefined) {
            var num_schools = 0
          } else {
            var num_schools = nest_schools[d.state_name][d.county_name].length
          }
          div
              .html("<b>Number of Law Schools: </b>" + num_schools)
              .style("left", (d3.event.pageX - 80) + "px")
              .style("top", (d3.event.pageY + 40) + "px");
      }

        function mouseout() {
        div.style("display", "none");
        d3.select(this)
          .style("stroke-width", 0);
      }

        function barColor(d) {
          if (nest_schools[d.state_name] == undefined || nest_schools[d.state_name][d.county_name] == undefined) {
            return "rgb(239,243,255)"
          } else if (nest_schools[d.state_name][d.county_name].length <= 2) {
            return "rgb(189,215,231)"
          } else if (nest_schools[d.state_name][d.county_name].length <= 4) {
            return "rgb(107,174,214)"
          } else if (nest_schools[d.state_name][d.county_name].length >= 5) {
            return "rgb(33,113,181)"
          }
        }

        </script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-74245662-1', 'auto');
          ga('send', 'pageview');

        </script>
    </body>
</html>
